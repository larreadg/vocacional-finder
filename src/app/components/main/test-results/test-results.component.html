<section class="grid">
    <section class="col-12 md:col-10 md:col-offset-1" *ngIf="testFinished">
      <p class="text-xl font-semibold m-0 text-primary">Top 3 - Áreas de interés</p>
      <p-divider></p-divider>
    </section>
    <section class="col-12 md:col-10 md:col-offset-1" *ngIf="testFinished">
        <section class="w-full lg:w-6 m-auto p-4 border-round-sm" [style]="{ backgroundColor: 'var(--surface-card)' }">
            <p-chart type="bar" [data]="chartData" [options]="chartOptions"></p-chart>
        </section>
    </section>
    <section class="col-12 md:col-10 md:col-offset-1" *ngIf="testFinished">
      <p class="text-xl font-semibold m-0 text-primary">Recomendaciones</p>
      <p-divider></p-divider>
    </section>
    <section class="col-12 md:col-10 md:col-offset-1" *ngIf="testFinished">
      <p-messages severity="info">
          <ng-template pTemplate>
              <p>Estas recomendaciones están basadas en la lista de carreas habilitadas por la <a class="font-bold" href="https://cones.gov.py" [style]="{ cursor: 'pointer', textDecoration: 'underline', color: '#3b82f6' }">CONES</a>. Para ver la lista completa, hace clic <a class="font-bold" href="https://cones.gov.py/resoluciones-de-habilitaciones/" [style]="{ cursor: 'pointer', textDecoration: 'underline', color: '#3b82f6' }">aquí</a></p>
          </ng-template>
      </p-messages>
    </section>
    <section class="col-12 md:col-10 md:col-offset-1" *ngIf="testFinished">
      <p-table #recTable [value]="recommendations" [paginator]="true" [rows]="5" [rowsPerPageOptions]="[5, 10, 20]" [globalFilterFields]="['profesion']">
        <ng-template pTemplate="caption">
          <div class="flex">
              <p-iconField iconPosition="left" [style]="{ width: '100%' }">
                  <p-inputIcon>
                      <i class="pi pi-search"></i>
                  </p-inputIcon>
                  <input 
                      class="w-full"
                      pInputText 
                      type="text" 
                      (input)="recTable.filterGlobal(($any($event).target.value), 'contains')" 
                      placeholder="Ingeniería..." />
              </p-iconField>
          </div>
      </ng-template>
        <ng-template pTemplate="header">
            <tr>
                <th class="text-primary">Profesión</th>
                <th class="text-primary">Universidades</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-rec let-rowIndex="rowIndex">
            <tr>
              <td>{{rec.profesion}}</td>
              <td>
                <p-button label="Ver lista ({{rec.universidades.length}})" styleClass="p-button-sm" icon="pi pi-building-columns" (onClick)="targetOpen(rec)" />
              </td>
            </tr>
        </ng-template>
      </p-table>
    </section>
    <section class="col-12 md:col-10 md:col-offset-1">
      <p class="text-xl font-semibold m-0 text-primary">Detalles del test</p>
      <p-divider></p-divider>
    </section>
    <section class="col-12 md:col-10 md:col-offset-1">
      <p-table [value]="sectionScores" [paginator]="true" [rows]="5" [rowsPerPageOptions]="[5, 10, 20]">
        <ng-template pTemplate="header">
            <tr>
                <th class="text-primary">Sección</th>
                <th class="text-primary">Área</th>
                <th class="text-primary">Respondidas</th>
                <th class="text-primary">Puntaje</th>
                <th class="text-primary">Máximo</th>
                <th class="text-primary">%</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-s>
            <tr>
              <td>{{s.section}}</td>
              <td>{{s.name}}</td>
              <td>{{s.answered}} / {{s.totalQuestions}}</td>
              <td>{{s.score}}</td>
              <td>{{s.maxScore}}</td>
              <td>{{s.percentage}}%</td>
            </tr>
        </ng-template>
      </p-table>
    </section>
    <section class="col-12 md:col-10 md:col-offset-1" *ngIf="testFinished">
      <section class="flex justify-content-center lg:justify-content-end gap-2">
        <p-button label="Borrar todo" styleClass="p-button-danger" icon="pi pi-trash" (onClick)="resetVisible = true" />
        <p-button label="Enviar resultados" icon="pi pi-send" (onClick)="sendResults()" />
      </section>
    </section>
</section>

<p-dialog [header]="targetProfesion" [modal]="true" [(visible)]="targetVisible" styleClass="w-10 lg:w-6">
  <section class="grid">
    <section class="col-12">
      <p-table [value]="targetUnis" [paginator]="true" [rows]="5" [rowsPerPageOptions]="[5, 10, 20]">
        <ng-template pTemplate="header">
            <tr>
                <th class="text-primary">Universidad</th>
                <th class="text-primary">Doc. Resp.</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-uni>
            <tr>
              <td>
                  <section class="flex flex-column gap-1">
                    <p class="m-0 text-sm font-semibold">{{uni.ies}}</p>
                    <p class="m-0 text-xs p-text-secondary">{{uni.sede}}</p>
                  </section>
              </td>
              <td>
                <p-button styleClass="p-button-sm" icon="pi pi-external-link" [link]="true" (onClick)="abrirEnNuevaPestana(uni.documento)" />
              </td>
            </tr>
        </ng-template>
      </p-table>
    </section>
  </section>
  <ng-template pTemplate="footer">
    <p-button 
        label="Cerrar" 
        [text]="true" 
        severity="secondary" 
        (onClick)="targetVisible = false" />
  </ng-template>
</p-dialog>

<p-dialog [header]="'Restablecer todo'" [modal]="true" [(visible)]="resetVisible" styleClass="w-10 lg:w-6">
  <section class="grid">
    <section class="col-12">
      <p>Esta acción eliminará todas tus respuestas del test vocacional. ¿Estás seguro?</p>
    </section>
  </section>
  <ng-template pTemplate="footer">
    <p-button 
        label="Cancelar" 
        [text]="true" 
        severity="secondary" 
        (onClick)="resetVisible = false" />
    <p-button 
        label="Si, confirmar" 
        [text]="true" 
        severity="danger" 
        (onClick)="reset()" />
  </ng-template>
</p-dialog>

<p-toast position="top-center" [style]="{'max-width':'calc(100vw - 2rem)'}"></p-toast>